from flask import Flask
from flask_socketio import SocketIO, send

app = Flask(__name__)
app.config['SECRET_KEY'] = "secret!"
socketio = SocketIO(app)

# HTML, CSS, and JavaScript are combined into a single string
HTML_PAGE = """
<!DOCTYPE html>
<html>
<head>
    <title>Simple Chat</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif; margin: 20px;
            background: #f9f9f9; display: flex; flex-direction: column;
            align-items: center;
        }
        #chat {
            border: 1px solid #ccc; border-radius: 6px; background: #fff;
            height: 300px; width: 90%; max-width: 600px;
            overflow-y: auto; padding: 10px; margin-bottom: 10px;
        }
        #chat p {
            margin: 6px 0; padding: 6px 10px; background: #f1f1f1;
            border-radius: 4px; word-wrap: break-word;
        }
        #input-area {
            display: flex; width: 90%; max-width: 600px;
        }
        #msg {
            flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
        }
        #send {
            margin-left: 10px; padding: 8px 16px; border: none;
            background: #007BFF; color: white; border-radius: 4px; cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>Simple Chat</h2>
    <div id="chat"></div>
    <div id="input-area">
        <input id="msg" type="text" placeholder="Type a message...">
        <button id="send">Send</button>
    </div>

    <script>
        const socket = io();
        const chat = document.getElementById("chat");
        const msgInput = document.getElementById("msg");
        const sendBtn = document.getElementById("send");

        socket.on("message", function(msg) {
            const p = document.createElement("p");
            p.textContent = msg;
            chat.appendChild(p);
            chat.scrollTop = chat.scrollHeight;
        });

        function sendMessage() {
            const msg = msgInput.value;
            if (msg.trim() !== "") {
                socket.send(msg);
                msgInput.value = "";
            }
        }

        sendBtn.onclick = sendMessage;
        msgInput.addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });
    </script>
</body>
</html>
"""

@app.route("/")
def index():
    # Return the HTML string directly
    return HTML_PAGE

@socketio.on("message")
def handle_message(msg):
    send(msg, broadcast=True)

if __name__ == "__main__":
    socketio.run(app, debug=True)
